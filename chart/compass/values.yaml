global:
  disableLegacyConnectivity: true
  defaultTenant: 3e64ebae-38b5-46a0-b1ed-9ccee153a0ae
  defaultTenantRegion: "eu-1"
  tenants: # tenant order matters, so new tenants should be added to the end of the list
    - name: default
      id: 3e64ebae-38b5-46a0-b1ed-9ccee153a0ae
      type: account
    - name: foo
      id: 1eba80dd-8ff6-54ee-be4d-77944d17b10b
      type: account
    - name: bar
      id: af9f84a9-1d3a-4d9f-ae0c-94f883b33b6e
      type: account
    - name: TestTenantSeparation
      id: f1c4b5be-b0e1-41f9-b0bc-b378200dcca0
      type: account
    - name: TestDeleteLastScenarioForApplication
      id: 0403be1e-f854-475e-9074-922120277af5
      type: account
    - name: Test_DeleteAutomaticScenarioAssignmentForSelector
      id: d9553135-6115-4c67-b4d9-962c00f3725f
      type: account
    - name: Test_AutomaticScenarioAssigmentForRuntime
      id: 8c733a45-d988-4472-af10-1256b82c70c0
      type: account
    - name: TestAutomaticScenarioAssignmentsWholeScenario
      id: 65a63692-c00a-4a7d-8376-8615ee37f45c
      type: account
    - name: TestTenantsQueryTenantNotInitialized
      id: 72329135-27fd-4284-9bcb-37ea8d6307d0
      type: account
    - name: Test Default
      id: 5577cf46-4f78-45fa-b55f-a42a3bdba868
      type: account
      parent: 2c4f4a25-ba9a-4dbc-be68-e0beb77a7eb0
    - name: Test_DefaultCustomer
      id: 2c4f4a25-ba9a-4dbc-be68-e0beb77a7eb0
      type: customer
    - name: TestListLabelDefinitions
      id: 3f641cf5-2d14-4e0f-a122-16e7569926f1
      type: account
    - name: Test_AutomaticScenarioAssignmentQueries
      id: 8263cc13-5698-4a2d-9257-e8e76b543e88
      type: account
    - name: TestGetScenariosLabelDefinitionCreatesOneIfNotExists
      id: 2263cc13-5698-4a2d-9257-e8e76b543e33
      type: account
    - name: TestApplicationsForRuntime
      id: 5984a414-1eed-4972-af2c-b2b6a415c7d7
      type: account
    - name: Test_DeleteAutomaticScenarioAssignmentForScenario
      id: d08e4cb6-a77f-4a07-b021-e3317a373597
      type: account
    - name: TestApplicationsForRuntimeWithHiddenApps
      id: 7e1f2df8-36dc-4e40-8be3-d1555d50c91c
      type: account
    - name: TestTenantsQueryTenantInitialized
      id: 8cf0c909-f816-4fe3-a507-a7917ccd8380
      type: account
    - name: TestDeleteApplicationIfInScenario
      id: 0d597250-6b2d-4d89-9c54-e23cb497cd01
      type: account
    - name: TestProviderSubaccount
      id: f8075207-1478-4a80-bd26-24a4785a2bfd
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestProviderSubaccountRegion2
      id: 731b7bc4-5472-41d2-a447-e4c0f45de739
      type: subaccount
      region: "eu-2"
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestCertificateSubaccount
      id: 123e4567-e89b-12d3-a456-426614174001
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestNsAdapter
      id: 08b6da37-e911-48fb-a0cb-fa635a6c5678
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestNsAdapterSubaccountWithApplications
      id: 08b6da37-e911-48fb-a0cb-fa635a6c4321
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestIntegrationSystemManagedSubaccount
      id: 3cfcdd62-320d-403b-b66a-4ee3cdd06947
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
    - name: TestIntegrationSystemManagedAccount
      id: 7e8ab2e3-3bb4-42e3-92b2-4e0bf48559d3
      type: account
      parent: 2c4f4a25-ba9a-4dbc-be68-e0beb77a7eb0
    - name: TestSystemFetcherAccount
      id: c395681d-11dd-4cde-bbcf-570b4a153e79
      type: account
      parent: 2c4f4a25-ba9a-4dbc-be68-e0beb77a7eb0
    - name: TestConsumerSubaccount
      id: 1f538f34-30bf-4d3d-aeaa-02e69eef84ae
      type: subaccount
      parent: 5984a414-1eed-4972-af2c-b2b6a415c7d7
    - name: TestTenantsOnDemandAPI
      id: 8d42d818-d4c4-4036-b82f-b199db7ffeb5
      type: subaccount
      parent: 5984a414-1eed-4972-af2c-b2b6a415c7d7
    - name: TestExternalCertificateSubaccount
      id: bad76f69-e5c2-4d55-bca5-240944824b83
      type: subaccount
      parent: 5577cf46-4f78-45fa-b55f-a42a3bdba868
  images:
    containerRegistry:
      path: eu.gcr.io/kyma-project/incubator
    connector:
      dir:
      version: "PR-2750"
      name: compass-connector
    connectivity_adapter:
      dir:
      version: "PR-2750"
      name: compass-connectivity-adapter
    pairing_adapter:
      dir:
      version: "PR-2750"
      name: compass-pairing-adapter
    director:
      dir:
      version: "PR-2757"
      name: compass-director
    hydrator:
      dir:
      version: "PR-2750"
      name: compass-hydrator
    gateway:
      dir:
      version: "PR-2750"
      name: compass-gateway
    operations_controller:
      dir:
      version: "PR-2750"
      name: compass-operations-controller
    ord_service:
      dir:
      version: "PR-82"
      name: compass-ord-service
    schema_migrator:
      dir:
      version: "PR-2746"
      name: compass-schema-migrator
    system_broker:
      dir:
      version: "PR-2750"
      name: compass-system-broker
    certs_setup_job:
      containerRegistry:
        path: eu.gcr.io/kyma-project
      dir:
      version: "0a651695"
    external_services_mock:
      dir:
      version: "PR-2750"
      name: compass-external-services-mock
    console:
      dir:
      version: "PR-72"
      name: compass-console
    e2e_tests:
      dir:
      version: "PR-2750"
      name: compass-e2e-tests
  isLocalEnv: false
  isForTesting: false
  oauth2:
    host: oauth2
  livenessProbe:
    initialDelaySeconds: 30
    timeoutSeconds: 1
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 5
    timeoutSeconds: 1
    periodSeconds: 2
  agentPreconfiguration: false
  portieris:
    isEnabled: false
    imagePullSecretName: "portieris-dummy-image-pull-secret"
  nsAdapter:
    external:
      port: 3005
    e2eTests:
      gatewayHost: "compass-gateway-xsuaa"
    prefix: /nsadapter
    path: /nsadapter/api/v1/notifications
    systemToTemplateMappings: '[{  "Name": "SAP S/4HANA On-Premise",  "SourceKey": ["type"],  "SourceValue": ["abapSys"]},{  "Name": "SAP S/4HANA On-Premise",  "SourceKey": ["type"],  "SourceValue": ["nonSAPsys"]},{  "Name": "SAP S/4HANA On-Premise",  "SourceKey": ["type"],  "SourceValue": ["hana"]}]'
    secret:
      name: nsadapter-secret
      subaccountKey: subaccount
      local:
        subaccountValue: subaccount
    authSecret:
      name: "compass-external-services-mock-oauth-credentials"
      clientIdKey: client-id
      clientSecretKey: client-secret
      tokenUrlKey: url
      instanceUrlKey: url
      certKey: cert
      keyKey: key
    registerPath: "/register"
    tokenPath: "/secured/oauth/token"
    createClonePattern: '{"key": "%s"}'
    createBindingPattern: '{}'
    useClone: "false"
  director:
    host: compass-director.compass-system.svc.cluster.local
    formationAsyncApi:
      pathPrefix: "/v1/businessIntegrations"
      path: "/{ucl-formation-id}/assignments/{ucl-assignment-id}/status"
    prefix: /director
    graphql:
      external:
        port: 3000
    tls:
      secure:
        internal:
          host: compass-director-internal
    validator:
      port: 8080
    metrics:
      port: 3003
      enableGraphqlOperationInstrumentation: true
    operations:
      port: 3002
      path: "/operation"
      lastOperationPath: "/last_operation"
    info:
      path: "/v1/info"
    subscription:
      subscriptionProviderLabelKey: "subscriptionProviderId"
      consumerSubaccountLabelKey: "global_subaccount_id"
      subscriptionLabelKey: "subscription"
      tokenPrefix: "sb-"
    selfRegister:
      secrets:
        instancesCreds:
          name: "region-instances-credentials"
          key: "keyConfig"
          path: "/tmp"
        saasAppNameCfg:
          name: "saas-app-names"
          key: "appNameConfig"
          path: "/tmp/appNameConfig"
      clientIdPath: "clientId"
      clientSecretPath: "clientSecret"
      urlPath: "url"
      tokenUrlPath: "tokenUrl"
      clientCertPath: "clientCert"
      clientKeyPath: "clientKey"
      local:
        templateMappings:
          clientIDMapping: '{{ printf "\"%s\":\"client_id\"" .Values.global.director.selfRegister.clientIdPath }}'
          clientSecretMapping: '{{ printf "\"%s\":\"client_secret\"" .Values.global.director.selfRegister.clientSecretPath }}'
          urlMapping: '{{ printf "\"%s\":\"http://compass-external-services-mock.%s.svc.cluster.local:%s\"" .Values.global.director.selfRegister.urlPath .Release.Namespace (.Values.service.port | toString) }}'
          tokenURLMapping: '{{ printf "\"%s\":\"https://%s.%s:%s\"" .Values.global.director.selfRegister.tokenUrlPath .Values.global.externalServicesMock.certSecuredHost .Values.global.ingress.domainName (.Values.service.certPort | toString) }}'
          x509CertificateMapping: '{{ printf "\"%s\":\"%s\"" .Values.global.director.selfRegister.clientCertPath .Values.global.connector.caCertificate }}'
          x509KeyMapping: '{{ printf "\"%s\":\"%s\"" .Values.global.director.selfRegister.clientKeyPath .Values.global.connector.caKey }}'
      oauthTokenPath: "/cert/token"
      oauthMode: "oauth-mtls"
      label: "selfRegLabel"
      labelValuePrefix: "self-reg-prefix-"
      responseKey: "self-reg-key"
      path: "/external-api/self-reg"
      nameQueryParam: "name"
      tenantQueryParam: "tenant"
      requestBodyPattern: '{"key": "%s"}'
      saasAppNameLabelKey: "CMPSaaSAppName"
      saasAppNamePath: "localSaaSAppNamePath"
    clientIDHeaderKey: client_user
    suggestTokenHeaderKey: suggest_token
    runtimeTypeLabelKey: "runtimeType"
    applicationTypeLabelKey: "applicationType"
    kymaRuntimeTypeLabelValue: "kyma"
    fetchTenantEndpoint: '{{ printf "https://%s.%s%s/v1/fetch" .Values.global.gateway.tls.secure.internal.host .Values.global.ingress.domainName .Values.global.tenantFetcher.prefix }}'
    ordWebhookMappings: '[]'
  auditlog:
    configMapName: "compass-gateway-auditlog-config"
    mtlsTokenPath: "/cert/token"
    standardTokenPath: "/secured/oauth/token"
    skipSSLValidation: false
    secret:
      name: "compass-gateway-auditlog-secret"
      urlKey: url
      clientIdKey: client-id
      clientSecretKey: client-secret
      clientCertKey: client-cert
      clientKeyKey: client-key
  log:
    format: "kibana"
  tenantConfig:
    useDefaultTenants: true
    dbPool:
      maxOpenConnections: 1
      maxIdleConnections: 1
  connector:
    prefix: /connector
    graphql:
      external:
        port: 3000
    validator:
      port: 8080
    # If secrets do not exist they will be created
    secrets:
      ca:
        name: compass-connector-app-ca
        namespace: compass-system
        certificateKey: ca.crt
        keyKey: ca.key
      rootCA:
        namespace: istio-system # For Ingress Gateway to work properly the namespace needs to be istio-system
        # In order for istio mTLS to work we should have two different secrets one containing the server certificate (let’s say X) and one used for validation of the client’s certificates.
        # The second one should be our root certificate and istio wants it to be named X-cacert. (-cacert suffix).
        # This is the reason for the confusing name of our root certificate. https://preliminary.istio.io/v1.6/docs/tasks/traffic-management/ingress/secure-ingress/#configure-a-mutual-tls-ingress-gateway
        cacert: compass-gateway-mtls-certs-cacert # For cert-rotation the cacert should be in different secret
        certificateKey: cacert
    revocation:
      configmap:
        name: revocations-config
        namespace: "{{ .Release.Namespace }}"
    # If key and certificate are not provided they will be generated
    caKey: ""
    caCertificate: ""
  system_broker:
    enabled: false
    port: 5001
    prefix: /broker
    tokenProviderFromHeader:
      forwardHeaders: Authorization
    tokenProviderFromSecret:
      enabled: false
      secrets:
        integrationSystemCredentials:
          name: compass-system-broker-credentials
          namespace: compass-system
    testNamespace: kyma-system
  gateway:
    port: 3000
    tls:
      host: compass-gateway
      adapterHost: compass-ns-adapter
      secure:
        internal:
          host: compass-gateway-internal
        oauth:
          host: compass-gateway-auth-oauth
    mtls:
      manageCerts: true
      host: compass-gateway-mtls
      certSecret: compass-gateway-mtls-certs
      external:
        host: compass-gateway-sap-mtls
        certSecret: compass-gateway-mtls-certs # Use connector's root CA as root CA by default. This should be overridden for productive deployments.
    headers:
      rateLimit: X-Flow-Identity
      request:
        remove:
          - "Client-Id-From-Token"
          - "Client-Id-From-Certificate"
          - "Client-Certificate-Hash"
          - "Certificate-Data"
  hydrator:
    host: compass-hydrator.compass-system.svc.cluster.local
    port: 3000
    prefix: /hydrators
    subjectConsumerMappingConfig: '[{"consumer_type": "Super Admin", "tenant_access_levels": ["customer", "account","subaccount"], "subject": "C=DE, L=local, O=SAP SE, OU=Region, OU=SAP Cloud Platform Clients, OU=f8075207-1478-4a80-bd26-24a4785a2bfd, CN=compass"}, {"consumer_type": "Integration System", "tenant_access_levels": ["account","subaccount"], "subject": "C=DE, L=local, O=SAP SE, OU=Region, OU=SAP Cloud Platform Clients, OU=f8075207-1478-4a80-bd26-24a4785a2bfd, CN=integration-system-test"}, {"consumer_type": "Technical Client", "tenant_access_levels": ["account","subaccount"], "subject": "C=DE, L=local, O=SAP SE, OU=SAP Cloud Platform Clients, OU=1f538f34-30bf-4d3d-aeaa-02e69eef84ae, CN=technical-client-test"}]'
    certificateDataHeader: "Certificate-Data"
    consumerClaimsKeys:
      clientIDKey: "client_id"
      tenantIDKey: "tenantid"
      userNameKey: "user_name"
      subdomainKey: "subdomain"
    http:
      client:
        skipSSLValidation: false
    metrics:
      port: 3003
      enableClientInstrumentation: true
      censoredFlows: "JWT"
  operations_controller:
    enabled: true
  connectivity_adapter:
    port: 8080
    tls:
      host: adapter-gateway
    mtls:
      host: adapter-gateway-mtls
  oathkeeperFilters:
    workloadLabel: oathkeeper
    namespace: kyma-system
    tokenDataHeader: "Connector-Token"
    certificateDataHeader: "Certificate-Data"
  istio:
    externalMtlsGateway:
      name: "compass-gateway-external-mtls"
      namespace: "compass-system"
    mtlsGateway:
      name: "compass-gateway-mtls"
      namespace: "compass-system"
    gateway:
      name: "kyma-gateway"
      namespace: "kyma-system"
    proxy:
      port: 15020
    namespace: istio-system
    ingressgateway:
      workloadLabel: istio-ingressgateway
      requestPayloadSizeLimit2MB: 2097152
      requestPayloadSizeLimit2MBLabel: "2MB"
      requestPayloadSizeLimit5MB: 5097152
      requestPayloadSizeLimit5MBLabel: "5MB"
      correlationHeaderRewriteFilter:
        expectedHeaders:
          - "x-request-id"
          - "x-correlation-id"
          - "x-correlationid"
          - "x-forrequest-id"
          - "x-vcap-request-id"
          - "x-broker-api-request-identity"
  kubernetes:
    serviceAccountTokenIssuer: https://kubernetes.default.svc.cluster.local
    serviceAccountTokenJWKS: https://kubernetes.default.svc.cluster.local/openid/v1/jwks
  ingress:
    domainName: "local.kyma.dev"
  database:
    sqlProxyServiceAccount: "proxy-user@gcp-cmp.iam.gserviceaccount.com"
    manageSecrets: true
    embedded:
      enabled: true
      director:
        name: "postgres"
      directorDBName: "postgres"
    managedGCP:
      serviceAccountKey: ""
      instanceConnectionName: ""
      director:
        name: ""
        user: ""
        password: ""
      host: "localhost"
      hostPort: "5432"
      sslMode: ""
      #TODO remove below after migration to separate user will be done
      dbUser: ""
      dbPassword: ""
      directorDBName: ""
  oathkeeper:
    host: ory-oathkeeper-proxy.kyma-system.svc.cluster.local
    port: 4455
    timeout_ms: 120000
    ns_adapter_timeout_ms: 3600000
    idTokenConfig:
      claims: '{"scopes": "{{ print .Extra.scope }}","tenant": "{{ .Extra.tenant }}", "consumerID": "{{ print .Extra.consumerID}}", "consumerType": "{{ print .Extra.consumerType }}", "flow": "{{ print .Extra.flow }}", "onBehalfOf": "{{ print .Extra.onBehalfOf }}", "region": "{{ print .Extra.region }}", "tokenClientID": "{{ print .Extra.tokenClientID }}"}'
      internalClaims: '{"scopes": "application:read application:write application.webhooks:read application_template.webhooks:read webhooks.auth:read runtime:write runtime:read tenant:read tenant:write tenant_subscription:write ory_internal fetch_tenant application_template:read destinations_sensitive_data:read destinations:sync application.local_tenant_id:write application_template:write","tenant":"{ {{ if .Header.Tenant }} \"consumerTenant\":\"{{ print (index .Header.Tenant 0) }}\", {{ end }} \"externalTenant\":\"\"}", "consumerType": "Internal Component", "flow": "Internal"}'
    mutators:
      runtimeMappingService:
        config:
          api:
            url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/runtime-mapping
            retry:
              give_up_after: 6s
              max_delay: 2000ms
      authenticationMappingServices:
        nsadapter:
          cfg:
            config:
              api:
                url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/authn-mapping/nsadapter
                retry:
                  give_up_after: 6s
                  max_delay: 2000ms
          authenticator:
            enabled: false
            createRule: true
            gatewayHost: "compass-gateway-xsuaa"
            trusted_issuers: '[{"domain_url": "compass-system.svc.cluster.local:8080", "scope_prefix": "prefix.", "protocol": "http"}]'
            attributes: '{"uniqueAttribute": { "key": "ns-adapter-test", "value": "ns-adapter-flow" }, "tenant": { "key": "tenant" }, "identity": { "key": "identity" }, "clientid": { "key": "client_id" } }'
            path: /nsadapter/api/v1/notifications
            upstreamComponent: "compass-gateway"
            checkSuffix: true
        tenant-fetcher:
          cfg:
            config:
              api:
                url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/authn-mapping/tenant-fetcher
                retry:
                  give_up_after: 6s
                  max_delay: 2000ms
          authenticator:
            enabled: false
            createRule: true
            gatewayHost: "compass-gateway"
            trusted_issuers: '[{"domain_url": "compass-system.svc.cluster.local:8080", "scope_prefix": "prefix.", "protocol": "http"}]'
            attributes: '{"uniqueAttribute": { "key": "test", "value": "tenant-fetcher" }, "tenant": { "key": "tenant" }, "identity": { "key": "identity" } }'
            path: /tenants/<.*>
            upstreamComponent: "compass-tenant-fetcher"
            checkSuffix: false
        subscriber:
          cfg:
            config:
              api:
                url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/authn-mapping/subscriber
                retry:
                  give_up_after: 6s
                  max_delay: 2000ms
          authenticator:
            enabled: false
            createRule: false
            gatewayHost: "compass-gateway-sap-mtls"
            trusted_issuers: '[{"domain_url": "compass-system.svc.cluster.local:8080", "scope_prefix": "prefix.", "protocol": "http", "region": "eu-1"}]'
            attributes: '{"uniqueAttribute": { "key": "subsc-key-test", "value": "subscription-flow" }, "tenant": { "key": "tenant" }, "identity": { "key": "user_name" }, "clientid": { "key": "client_id" } }'
            path: /<.*>
            checkSuffix: false
      tenantMappingService:
        config:
          api:
            url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/tenant-mapping
            retry:
              give_up_after: 6s
              max_delay: 2000ms
      certificateResolverService:
        config:
          api:
            url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/v1/certificate/data/resolve
            retry:
              give_up_after: 6s
              max_delay: 2000ms
      tokenResolverService:
        config:
          api:
            url: http://compass-hydrator.compass-system.svc.cluster.local:3000/hydrators/v1/tokens/resolve
            retry:
              give_up_after: 6s
              max_delay: 2000ms
  cockpit:
    auth:
      allowedConnectSrc: "https://*.ondemand.com"
      secretName: "cockpit-auth-secret"
      idpHost: ""
      clientID: ""
      scopes: "openid profile email"
      path: "/oauth2/certs"
  destinationFetcher:
    manageSecrets: true
    host: compass-destination-fetcher.compass-system.svc.cluster.local
    prefix: /destination-configuration
    port: 3000
    jobSchedule: 10m
    lease:
      lockname: destinationlease
    parallelTenants: 10
    tenantSyncTimeout: "5m"
    authentication:
      jwksEndpoint: "http://ory-oathkeeper-api.kyma-system.svc.cluster.local:4456/.well-known/jwks.json"
      appDestinationsSyncScope: "destinations:sync"
      appDetinationsSensitiveDataScope: "destinations_sensitive_data:read"
    server:
      tenantDestinationsEndpoint: "/v1/subaccountDestinations"
      sensitiveDataEndpoint: "/v1/destinations"
      sensitiveDataQueryParam: "name"
    request:
      skipSSLValidation: false
      retry_interval: "100ms"
      retry_attempts: 3
      goroutineLimit: 10
      requestTimeout: "5s"
      pageSize: 100
      oauthTokenPath: "/oauth/token"
    instance:
      clientIdPath: "clientid"
      clientSecretPath: "clientsecret"
      urlPath: "uri"
      tokenUrlPath: "certurl"
      clientCertPath: "certificate"
      clientKeyPath: "key"
    secretName: destination-region-instances
    dependenciesConfig:
      path: "/cfg/dependencies"
    oauthMode: "oauth-mtls"
  destinationRegionSecret:
    secretName: "destination-region-instances"
    fileName: "keyConfig"
    local:
      templateMappings:
        xsappMapping: '{{ printf "\"%s\":\"xsappname1\"" .Values.global.tenantFetcher.xsappNamePath }}'
        clientIDMapping: '{{ printf "\"%s\":\"client_id\"" .Values.global.destinationFetcher.instance.clientIdPath }}'
        clientSecretMapping: '{{ printf "\"%s\":\"client_secret\"" .Values.global.destinationFetcher.instance.clientSecretPath }}'
        urlMapping: '{{ printf "\"%s\":\"http://compass-external-services-mock.%s.svc.cluster.local:%s\"" .Values.global.destinationFetcher.instance.urlPath .Release.Namespace (.Values.service.port | toString) }}'
        tokenURLMapping: '{{ printf "\"%s\":\"https://%s.%s:%s\"" .Values.global.destinationFetcher.instance.tokenUrlPath .Values.global.externalServicesMock.certSecuredHost .Values.global.ingress.domainName (.Values.service.certPort | toString) }}'
        x509CertificateMapping: '{{ printf "\"%s\":\"%s\"" .Values.global.destinationFetcher.instance.clientCertPath .Values.global.connector.caCertificate }}'
        x509KeyMapping: '{{ printf "\"%s\":\"%s\"" .Values.global.destinationFetcher.instance.clientKeyPath .Values.global.connector.caKey }}'
  tenantFetcher:
    k8sSecret:
      manageSecrets: true
      name: "tenant-fetcher-secret"
      namespace: "compass-system"
      key: "keyConfig"
      path: "/tmp"
    host: compass-tenant-fetcher.compass-system.svc.cluster.local
    prefix: /tenants
    port: 3000
    xsappNamePath: "xsappname"
    omitDependenciesParamName: ""
    omitDependenciesParamValue: ""
    requiredAuthScope: Callback
    fetchTenantAuthScope: fetch_tenant
    authentication:
      jwksEndpoint: "http://ory-oathkeeper-api.kyma-system.svc.cluster.local:4456/.well-known/jwks.json"
    tenantProvider:
      tenantIdProperty: "tenantId"
      customerIdProperty: "customerId"
      subaccountTenantIdProperty: "subaccountTenantId"
      subdomainProperty: "subdomain"
      name: "provider"
      subscriptionProviderIdProperty: "subscriptionProviderIdProperty"
      providerSubaccountIdProperty: "providerSubaccountIdProperty"
      consumerTenantIdProperty: "consumerTenantIdProperty"
      subscriptionProviderAppNameProperty: "subscriptionProviderAppNameProperty"
    server:
      fetchTenantEndpoint: "/v1/fetch/{parentTenantId}/{tenantId}"
      regionalHandlerEndpoint: "/v1/regional/{region}/callback/{tenantId}"
      dependenciesEndpoint: "/v1/regional/{region}/dependencies"
      tenantPathParam: "tenantId"
      regionPathParam: "region"
    dependenciesConfig:
      path: "/cfg/dependencies"
    local:
      templateMappings:
        xsappMapping: '{{ printf "\"%s\":\"xsappname1\"" .Values.global.tenantFetcher.xsappNamePath }}'
    containerName: "tenant-fetcher"
  externalCertConfiguration:
    issuerLocality: "local,local2" # In local setup we have manually created connector CA certificate with 'local' Locality property
    subjectPattern: "/C=DE/O=SAP SE/OU=SAP Cloud Platform Clients/OU=Region/OU=%s/L=%s/CN=%s"
    technicalClientSubjectPattern: "/C=DE/O=SAP SE/OU=SAP Cloud Platform Clients/OU=%s/L=%s/CN=%s"
    ouCertSubaccountID: "f8075207-1478-4a80-bd26-24a4785a2bfd"
    commonName: "compass"
    locality: "local"
    certSvcApiPath: "/cert"
    tokenPath: "/cert/token"
    secrets:
      externalCertSvcSecret:
        manage: false
        name: "cert-svc-secret"
        clientIdKey: client-id
        clientSecretKey: client-secret
        oauthUrlKey: url
        csrEndpointKey: csr-endpoint
        clientCert: client-cert
        clientKey: client-key
        skipSSLValidationFlag: "-k"
      externalClientCertSecret:
        name: "external-client-certificate"
        namespace: compass-system
        certKey: tls.crt
        keyKey: tls.key
    rotationCronjob:
      name: "external-certificate-rotation"
      schedule: "*/1 * * * *" # Executes every minute
      certValidity: "7"
      clientCertRetryAttempts: "8"
      containerName: "certificate-rotation"
  extSvcCertConfiguration:
    issuerLocality: "local,local2" # In local setup we have manually created connector CA certificate with 'local' Locality property
    subjectPattern: "/C=DE/O=SAP SE/OU=SAP Cloud Platform Clients/OU=Region/OU=%s/L=%s/CN=%s"
    ouCertSubaccountID: "f8075207-1478-4a80-bd26-24a4785a2bfd"
    commonName: "compass"
    locality: "local"
    certSvcApiPath: "/cert"
    tokenPath: "/cert/token"
    secrets:
      extSvcCertSvcSecret:
        manage: false
        name: "ext-svc-cert-svc-secret"
        clientIdKey: client-id
        clientSecretKey: client-secret
        oauthUrlKey: url
        csrEndpointKey: csr-endpoint
        clientCert: client-cert
        clientKey: client-key
        skipSSLValidationFlag: "-k"
      extSvcClientCertSecret:
        name: "ext-svc-client-certificate"
        namespace: compass-system
        certKey: tls.crt
        keyKey: tls.key
    rotationCronjob:
      name: "ext-svc-certificate-rotation"
      schedule: "*/1 * * * *" # Executes every minute
      certValidity: "7"
      clientCertRetryAttempts: "8"
      containerName: "ext-svc-certificate-rotation"
  ordService:
    host: compass-ord-service.compass-system.svc.cluster.local
    prefix: /open-resource-discovery-service/v0
    docsPrefix: /open-resource-discovery-docs
    staticPrefix: /open-resource-discovery-static/v0
    port: 3000
    defaultResponseType: "xml"
    userContextHeader: "user_context"
    authTokenPath: "/var/run/secrets/kubernetes.io/serviceaccount/token"
    skipSSLValidation: false
  ordAggregator:
    name: ord-aggregator
    enabled: true
    suspend: true
    schedule: "*/1 * * * *"
    http:
      client:
        skipSSLValidation: false
      retry:
        attempts: 3
        delay: 100ms
    dbPool:
      maxOpenConnections: 2
      maxIdleConnections: 2
    globalRegistryUrl: http://compass-external-services-mock.compass-system.svc.cluster.local:8087/.well-known/open-resource-discovery
    maxParallelWebhookProcessors: 4
    maxParallelDocumentsPerApplication: 10
    maxParallelSpecificationProcessors: 100
    ordWebhookPartialProcessURL: ""
    ordWebhookPartialProcessMaxDays: 0
    ordWebhookPartialProcessing: false
    containerName: "ord-aggregator"
  systemFetcher:
    enabled: false
    name: "system-fetcher"
    schedule: "0 0 * * *"
    manageSecrets: true
    # enableSystemDeletion - whether systems in deleted state should be deleted from director database
    enableSystemDeletion: true
    # fetchParallelism - shows how many http calls will be made in parallel to fetch systems
    fetchParallellism: 30
    # queueSize - shows how many system fetches (individual requests may fetch more than 1 system)
    # can be put in the queue for processing before blocking. It is best for the queue to be about 2 times bigger than the parallellism
    queueSize: 100
    # fetchRequestTimeout - shows the timeout to wait for oauth token and for fetching systems (in one request) separately
    fetchRequestTimeout: "30s"
    # directorRequestTimeout - graphql requests timeout to director
    directorRequestTimeout: "30s"
    dbPool:
      maxOpenConnections: 20
      maxIdleConnections: 2
    # systemsAPIEndpoint - endpoint of the service to fetch systems from
    systemsAPIEndpoint: ""
    # systemsAPIFilterCriteria - criteria for fetching systems
    systemsAPIFilterCriteria: ""
    appTemplatesProductLabel: "systemRole"
    systemSourceKey: "prop"
    appTemplates: []
    templatePlaceholderToSystemKeyMappings: '[ { "placeholder_name": "name", "system_key": "displayName" }, { "placeholder_name": "display-name", "system_key": "displayName" }, { "placeholder_name": "systemNumber", "system_key": "systemNumber" }, { "placeholder_name": "productId", "system_key": "productId" }, { "placeholder_name": "ppmsProductVersionId", "system_key": "ppmsProductVersionId", "optional": true }, { "placeholder_name": "description", "system_key": "productDescription", "optional": true }, { "placeholder_name": "baseUrl", "system_key": "additionalUrls.mainUrl", "optional": true }, { "placeholder_name": "providerName", "system_key": "infrastructureProvider", "optional": true } ]'
    templateOverrideApplicationInput: '{"name": "{{name}}","description": "{{description}}","providerName": "{{providerName}}","statusCondition": "INITIAL","systemNumber": "{{systemNumber}}","labels": {"managed": "true","productId": "{{productId}}","ppmsProductVersionId": "{{ppmsProductVersionId}}"},"baseUrl": "{{baseUrl}}"}'
    http:
      client:
        skipSSLValidation: false
    oauth:
      client: "client_id"
      tokenEndpointProtocol: "https"
      tokenBaseHost: "compass-external-services-mock-sap-mtls"
      tokenPath: "/cert/token"
      scopesClaim: "scopes"
      tenantHeaderName: "x-zid"
      tokenRequestTimeout: 30s
      skipSSLValidation: true
    secret:
      name: "compass-system-fetcher-secret"
      clientIdKey: client-id
      oauthUrlKey: url
    paging:
      pageSize: 200
      sizeParam: "$top"
      skipParam: "$skip"
    containerName: "system-fetcher"
  tenantFetchers:
    job1:
      enabled: false
      job:
        interval: "5m"
      configMapNamespace: "compass-system"
      manageSecrets: true
      providerName: "compass"
      tenantType: "subaccount"
      schedule: "*/5 * * * *"
      tenantInsertChunkSize: "500"
      kubernetes:
        configMapNamespace: "compass-system"
        pollInterval: 2s
        pollTimeout: 1m
        timeout: 2m
      authConfig:
        skipSSLValidation: true
        oauthMode: "oauth-mtls"
        clientIDPath: "clientid"
        clientSecretPath: "secret"
        clientCertPath: "cert"
        clientKeyPath: "key"
        tokenEndpointPath: "url"
        tokenURLPath: "/cert/token"
      queryMapping:
        regionField: "region"
        pageNumField: "pageNum"
        pageSizeField: "pageSize"
        timestampField: "timestamp"
      query:
        startPage: "0"
        pageSize: "100"
      api:
        regionName: "central"
        authConfigSecretKey: "central"
        fieldMapping:
          totalPagesField: "totalPages"
          totalResultsField: "totalResults"
          tenantEventsField: "events"
          idField: "id"
          nameField: "name"
          customerIdField: "customerId"
          subdomainField: "subdomain"
          discriminatorField: ""
          discriminatorValue: ""
          detailsField: "details"
          entityTypeField: "entityType"
          globalAccountID: "gaID"
          regionField: "region"
          movedSubaccountTargetField: "targetGlobalAccountGUID"
          movedSubaccountSourceField: "sourceGlobalAccountGUID"
        endpoints:
          accountCreated: "127.0.0.1/events?type=account-created"
          accountDeleted: "127.0.0.1/events?type=account-deleted"
          accountUpdated: "127.0.0.1/events?type=account-updated"
          subaccountCreated: "127.0.0.1/events?type=subaccount-created"
          subaccountDeleted: "127.0.0.1/events?type=subaccount-deleted"
          subaccountUpdated: "127.0.0.1/events?type=subaccount-updated"
          subaccountMoved: "127.0.0.1/events?type=subaccount-moved"
      regionalConfig:
        fieldMapping:
          totalPagesField: "totalPages"
          totalResultsField: "totalResults"
          tenantEventsField: "events"
          idField: "guid"
          nameField: "displayName"
          customerIdField: "customerId"
          subdomainField: "subdomain"
          discriminatorField: ""
          discriminatorValue: ""
          detailsField: "details"
          entityTypeField: "entityType"
          globalAccountID: "globalAccountGUID"
          regionField: "region"
          movedSubaccountTargetField: "targetGlobalAccountGUID"
          movedSubaccountSourceField: "sourceGlobalAccountGUID"
        regions:
          eu-east:
            api:
              oauthMode: "oauth-mtls"
              authConfigSecretKey: "central"
              endpoints:
                accountCreated: "127.0.0.1/events?type=account-created"
                accountDeleted: "127.0.0.1/events?type=account-deleted"
                accountUpdated: "127.0.0.1/events?type=account-updated"
                subaccountCreated: "127.0.0.1/events?type=subaccount-created"
                subaccountDeleted: "127.0.0.1/events?type=subaccount-deleted"
                subaccountUpdated: "127.0.0.1/events?type=subaccount-updated"
                subaccountMoved: "127.0.0.1/events?type=subaccount-moved"
      dbPool:
        maxOpenConnections: 1
        maxIdleConnections: 1
  metrics:
    enabled: true
    pushEndpoint: http://monitoring-prometheus-pushgateway.kyma-system.svc.cluster.local:9091
  externalServicesMock:
    enabled: false
    certSecuredPort: 8081
    ordCertSecuredPort: 8082
    unsecuredPort: 8083
    basicSecuredPort: 8084
    oauthSecuredPort: 8085
    ordGlobalRegistryCertPort: 8086
    ordGlobalRegistryUnsecuredPort: 8087
    unsecuredPortWithAdditionalContent: 8088
    unsecuredMultiTenantPort: 8089
    certSecuredHost: compass-external-services-mock-sap-mtls
    ordCertSecuredHost: compass-external-services-mock-sap-mtls-ord
    ordGlobalCertSecuredHost: compass-external-services-mock-sap-mtls-global-ord-registry
    unSecuredHost: compass-external-services-mock
    host: compass-external-services-mock.compass-system.svc.cluster.local
    saasAppNamesSecret:
      manage: false
    regionInstancesCredentials:
      manage: false
    oauthSecret:
      manage: false
      name: compass-external-services-mock-oauth-credentials
      clientIdKey: client-id
      clientSecretKey: client-secret
      oauthUrlKey: url
      oauthTokenPath: "/secured/oauth/token"
    auditlog:
      applyMockConfiguration: false
      managementApiPath: /audit-log/v2/configuration-changes/search
      mtlsTokenPath: "/cert/token"
      secret:
        name: "auditlog-instance-management"
        urlKey: url
        tokenUrlKey: token-url
        clientIdKey: client-id
        clientSecretKey: client-secret
        clientCertKey: client-cert
        clientKeyKey: client-key
  tests:
    http:
      client:
        skipSSLValidation: false
    externalCertConfiguration:
      ouCertSubaccountID: "bad76f69-e5c2-4d55-bca5-240944824b83"
      issuerLocalityRegion2: "local"
    director:
      skipPattern: ""
      externalCertIntSystemCN: "integration-system-test"
      supportedOrdApplicationType: "SAP temp1"
    tenantFetcher:
      tenantOnDemandID: "8d42d818-d4c4-4036-b82f-b199db7ffeb5"
      region: "eu-1"
      region2: "eu-2"
    ordAggregator:
      skipPattern: ""
    ordService:
      accountTenantID: "5577cf46-4f78-45fa-b55f-a42a3bdba868" # testDefaultTenant from our testing tenants
      skipPattern: ""
    externalServicesMock:
      skipPattern: ""
      formationAsyncApi:
        responseDelayInSeconds: 2
    selfRegistration:
      region: "eu-1"
      region2: "eu-2"
    destination:
      consumerSubdomain: "compass-external-services-mock-sap-mtls"
    subscription:
      consumerSubdomain: "compass-external-services-mock-sap-mtls"
      tenants:
        providerAccountID: "5577cf46-4f78-45fa-b55f-a42a3bdba868" # testDefaultTenant from our testing tenants
        providerSubaccountID: "f8075207-1478-4a80-bd26-24a4785a2bfd" # TestProviderSubaccount from our testing tenants
        consumerAccountID: "5984a414-1eed-4972-af2c-b2b6a415c7d7" # ApplicationsForRuntimeTenantName from our testing tenants
        consumerSubaccountID: "1f538f34-30bf-4d3d-aeaa-02e69eef84ae" # randomly chosen
        consumerTenantID: "ba49f1aa-ddc1-43ff-943c-fe949857a34a" # randomly chosen
        providerSubaccountIDRegion2: "731b7bc4-5472-41d2-a447-e4c0f45de739" # TestProviderSubaccountRegion2 from our testing tenants
      oauthSecret:
        manage: false
        name: compass-subscription-secret
        clientIdKey: client-id
        clientSecretKey: client-secret
        oauthUrlKey: url
      propagatedProviderSubaccountHeader: "X-Provider-Subaccount"
      externalClientCertTestSecretName: "external-client-certificate-test-secret"
      externalClientCertTestSecretNamespace: "compass-system"
      externalCertTestJobName: "external-certificate-rotation-test-job"
      certSvcInstanceTestSecretName: "cert-svc-secret"
      certSvcInstanceTestRegion2SecretName: "cert-svc-secret-eu2"
      consumerTokenURL: "http://compass-external-services-mock.compass-system.svc.cluster.local:8080"
      subscriptionURL: "http://compass-external-services-mock.compass-system.svc.cluster.local:8080"
      subscriptionProviderIdValue: "id-value!t12345"
      subscriptionProviderAppNameValue: "subscriptionProviderAppNameValue"
    namespace: kyma-system
    connectivityAdapterFQDN: http://compass-connectivity-adapter.compass-system.svc.cluster.local
    externalServicesMockFQDN: http://compass-external-services-mock.compass-system.svc.cluster.local
    ordServiceFQDN: http://compass-ord-service.compass-system.svc.cluster.local
    systemBrokerFQDN: http://compass-system-broker.compass-system.svc.cluster.local
    tenantFetcherFQDN: http://compass-tenant-fetcher.compass-system.svc.cluster.local
    hydratorFQDN: http://compass-hydrator.compass-system.svc.cluster.local
    basicCredentials:
      manage: false
      secretName: "test-basic-credentials-secret"
    db:
      maxOpenConnections: 3
      maxIdleConnections: 1
    securityContext: # Set on container level
      runAsUser: 2000
      allowPrivilegeEscalation: false
  expectedSchemaVersionUpdateJob:
    cm:
      name: "expected-schema-version"
  migratorJob:
    nodeSelectorEnabled: false
    pvc:
      name: "compass-director-migrations"
      namespace: "compass-system"
      migrationsPath: "/compass-migrations"
      storageClass: local-path
  http:
    client:
      skipSSLValidation: false
  pairingAdapter:
    templateName: "pairing-adapter-app-template"
    watcherCorrelationID: "pairing-adapter-watcher-id"
    configMap:
      manage: false
      key: "config.json"
      name: "pairing-adapter-config-local"
      namespace: "compass-system"
      localAdapterFQDN: "http://compass-pairing-adapter.compass-system.svc.cluster.local/adapter-local-mtls"
      integrationSystemID: "d3e9b9f5-25dc-4adb-a0a0-ed69ef371fb6"
    e2e:
      appName: "test-app"
      appID: "123-test-456"
      clientUser: "test-user"
      tenant: "test-tenant"
  # Scopes assigned for every new Client Credentials by given object type (Runtime / Application / Integration System)
  # and scopes mapped to a consumer with the given type, then that consumer is using a client certificate
  scopes:
    scopesPerConsumerType:
      technical_client:
        - "tenant:read"
        - "tenant:write"
      runtime:
        - "runtime:read"
        - "runtime:write"
        - "application:read"
        - "runtime.auths:read"
        - "bundle.instance_auths:read"
        - "runtime.webhooks:read"
        - "webhook:write"
      external_certificate:
        - "runtime:read"
        - "runtime:write"
        - "application:read"
        - "application:write"
        - "runtime.auths:read"
        - "bundle.instance_auths:read"
        - "runtime.webhooks:read"
        - "webhook:write"
        - "application_template:read"
        - "application_template:write"
      application:
        - "application:read"
        - "application:write"
        - "application.auths:read"
        - "application.webhooks:read"
        - "bundle.instance_auths:read"
        - "document.fetch_request:read"
        - "event_spec.fetch_request:read"
        - "api_spec.fetch_request:read"
        - "fetch-request.auth:read"
        - "webhook:write"
      integration_system:
        - "application:read"
        - "application:write"
        - "application.local_tenant_id:write"
        - "application_template:read"
        - "application_template:write"
        - "runtime:read"
        - "runtime:write"
        - "integration_system:read"
        - "label_definition:read"
        - "label_definition:write"
        - "automatic_scenario_assignment:read"
        - "automatic_scenario_assignment:write"
        - "integration_system.auths:read"
        - "application_template.webhooks:read"
        - "formation:write"
        - "formation:read"
        - "internal_visibility:read"
        - "application.auths:read"
        - "webhook:write"
        - "formation_template:read"
      super_admin:
        - "application:read"
        - "application:write"
        - "application.local_tenant_id:write"
        - "application_template:read"
        - "application_template:write"
        - "integration_system:read"
        - "integration_system:write"
        - "runtime:read"
        - "runtime:write"
        - "label_definition:read"
        - "label_definition:write"
        - "eventing:manage"
        - "tenant:read"
        - "automatic_scenario_assignment:read"
        - "automatic_scenario_assignment:write"
        - "application.auths:read"
        - "application.webhooks:read"
        - "application_template.webhooks:read"
        - "bundle.instance_auths:read"
        - "document.fetch_request:read"
        - "event_spec.fetch_request:read"
        - "api_spec.fetch_request:read"
        - "integration_system.auths:read"
        - "runtime.auths:read"
        - "fetch-request.auth:read"
        - "webhooks.auth:read"
        - "formation:write"
        - "formation:read"
        - "internal_visibility:read"
        - "runtime.webhooks:read"
        - "webhook:write"
        - "formation_template:read"
        - "formation_template:write"
      default:
        - "runtime:read"
        - "runtime:write"
        - "tenant:read"
