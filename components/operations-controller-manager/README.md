# Operations Controller

## Overview

Operations Controller is a [Kubebuilder](https://github.com/kubernetes-sigs/kubebuilder) project. This Kubebuilder project features an `Operation` of type CustomResourceDefinition (CRD) and a Kubernetes Controller for it. It also provides several key resources that are accessible at the given locations:

- `api/v1alpha1/operation_types.go`\
The `operation_types.go` file contains the CRD that is generated by the Operations Controller.

- `config/crd/bases/operations.compass_operations.yaml`\
The `operations.compass_operations.yaml` file is generated from the `operation_types.go` CRD.

- `config/samples/operations_v1alpha1_operation.yaml`\
The `operations_v1alpha1_operation.yaml` file contains a sample of the CRD.

- `controllers/operation_controller.go`\
The `operation_controller.go` file is a Kubernetes controller for the CRD.

## Prerequisites

- Docker
- Kubernetes CLI
- Kubernetes cluster

## Installation

### CRD

1. To install the CRD into a Kubernetes cluster, use the following command: `make install`.
2. To revert the CRD installation, use the following command: `make uninstall`.

### Controller

1.	To deploy the Kubernetes controller for the operation CRD onto a Kubernetes cluster, use the following command: `make deploy`.
2.	To run a local instance of the controller operation CRD, use the following command: `make run`.

## Usage and Development

### CRD

1.	If there are changes to the CRD, you must regenerate the files that define the CRD.\
To do this, use the following command: `make manifests`.

2.	As a next step, you must copy these files to the component's Helm chart at the following location: `compass/chart/compass/charts/operations-controller`.\
To do this, use the following command: `make copy-crds-to-chart`.

### Controller

If there are changes to the controller, you must proceed with one of the following options:
- Direct deployment
  - Using the `make deploy` command, you can deploy the new version of the controller directly into the Kubernetes cluster described by the `~/.kube/config` file.
  - Alternatively, you can use the `make run` command to run an instance of the controller locally. This also connects to the Kubernetes cluster described by the `~/.kube/config` file.\
  The advantage of the `make run` command is that it provides a faster development cycle.

- Manual deployment\
Create a Docker image for the new version of the controller. Then, deploy the image manually on a Kubernetes cluster.
