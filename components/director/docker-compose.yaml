version: '3.1'
services:
  primary:
    image: postgres:12
    user: root
    container_name: test-postgres
    environment:
      POSTGRES_HOST: "127.0.0.1"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "pgsql@12345"
      POSTGRES_DB: "compass"
      POSTGRES_PORT: "5432"
      PGDATA: /var/lib/postgresql/data
    volumes:
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/migrations/:/tmp/migrations
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/seeds:/tmp
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/repl:/tmp
    networks:
      - app-network
    ports:
      - "5432:5432"
    entrypoint:  ["/tmp/repl/entrypoint.sh", "/tmp/repl/init-primary.sql", "12"]
  secondary:
    image: postgres:14
    user: root
    container_name: test-postgres-replica
    environment:
      POSTGRES_HOST: "127.0.0.1"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "pgsql@12345"
      POSTGRES_DB: "compass"
      POSTGRES_PORT: "5432"
      PGDATA: /var/lib/postgresql/data
    volumes:
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/migrations/:/tmp/migrations
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/seeds:/tmp
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/repl/*:/tmp
    networks:
      - app-network
    ports:
      - "6432:5432"
    entrypoint:  ["/tmp/repl/entrypoint.sh", "/tmp/repl/init-replica.sql", "14"]
  ev-reader:
    image: ubuntu
    container_name: ubuntu-events
    networks:
      - app-network
    entrypoint:  ["/tmp/repl/ubuntu.sh"]
    volumes:
      - /Users/i537925/SAPDevelop/go/src/github.com/kyma-incubator/compass/components/schema-migrator/seeds:/tmp
networks:
  app-network:
    driver: bridge