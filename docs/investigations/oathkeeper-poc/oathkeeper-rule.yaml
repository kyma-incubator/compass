apiVersion: oathkeeper.ory.sh/v1alpha1
kind: Rule
metadata:
  name: compass-gateway
  namespace: compass-system
spec:
  description: Test
  upstream:
    url: http://compass-gateway.compass-system.svc.cluster.local:3000
  match:
    methods: ["GET", "POST", "OPTIONS"]
    url: <http|https>://compass-gateway.kyma.local/<.*>
  authenticators:
    - handler: oauth2_introspection
      "config": {
        "required_scope": ["scope-a", "scope-b"]
      }
  authorizer:
    handler: allow
  mutators:
    - handler: hydrator
      config:
        api:
          url: http://compass-healthchecker.compass-system.svc.cluster.local:3000
    - handler: id_token
      config:
        claims: '{"tenant": "{{ print .Extra.tenant }}", "scope": "{{print .Extra.scope }}"}'